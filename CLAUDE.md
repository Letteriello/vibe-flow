# Project Notes

Generated by vibe-flow wrap-up

## Project Rules

- Always use exact versions for TypeScript (e.g., "5.3.3" not "^5.3.3") to avoid breaking changes from newer versions
- Tests e2e devem usar ESM imports com fileURLToPath para __dirname
- Fixtures path devem ser resolvidos a partir da raiz do projeto usando path.resolve(__dirname, '../..')
- Interfaces TypeScript devem ter tipos explícitos para todas as propriedades (evitar unknown)


## Session Notes (2026-02-25)
- Wrap-up session executed

## Session Notes (2026-02-25)
- Wrap-up session executed

## Session Notes (2026-02-25)
- Wrap-up session executed

## Session Notes (2026-02-25)
- Wrap-up session executed

## Session Notes (2026-02-26)
- Tested validateTypeScriptFile() - works correctly
- TypeScript syntax validation via tsc CLI functional
- Updated timeout_utils.sh and package dependencies
- Fixed TypeScript build: pinned to exact version 5.3.3
- Fixed type mismatch in context-summarizer.ts (Summary[] vs Summary)

## Session Notes (2026-02-27)
- Implemented hierarchical compaction system in src/context/compaction.ts
- Created ContextManager class in src/context/context-manager.ts
- getOptimizedContext() returns lean state and triggers background summarization
- Fixed path.isAbsolute import for Windows compatibility
- 21 unit tests passing - verifies payload reduction

## Session Notes (20226)
- Im6-02-plemented StateDriftDetector directory hash functionality
- Added calculateDirectoryHash() - calculates SHA-256 hash of all files in .vibe-flow/
- Added saveDirectoryHash() - saves hash to state.json for baseline comparison
- Added checkDirectoryDrift() - compares current hash with saved hash
- Added checkAndWarnDrift() - emits warning to user with "analyze_project" suggestion
- All existing tests pass (14 tests)

## Session Notes (2026-02-26)
- Implemented telemetry system for phase transition tracking
- Added MetricEvent interface to src/types.ts
- Created TelemetryCollector class in src/telemetry/index.ts
- Integrated telemetry timing into StateMachine (transition method)
- Fixed syntax errors in src/help/index.ts and src/error-handler/index.ts
- Build successful - telemetry.json being populated correctly

## Session Notes (2026-02-26)
- Wrap-up session executed

## Session Notes (2026-02-26)
- Wrap-up session executed

## Session Notes (2026-02-26)
- Wrap-up session executed

## Session Notes (2026-02-26)
- Implemented agent driver system with Circuit Breaker pattern
- Created src/drivers/ module with:
  - types.ts: AgentDriver interface with executeTask(task: string)
  - claude-code.ts: ClaudeCodeDriver mock implementation
  - codex.ts: CodexDriver mock implementation
  - router.ts: AgentRouter with Circuit Breaker (CLOSED/OPEN/HALF_OPEN states)
  - Auto-fallback on rate limit errors (429, "Rate Limit", "Too Many Requests")
  - Transparent failover returns DriverResult with success/result/error/driverUsed
- Build successful - all TypeScript compiles correctly

## Session Notes (2026-02-26)
- Wrap-up session executed

## Session Notes (2026-02-27)
- Created telemetry modules for usage tracking:
  - src/telemetry/logger.ts: Simple logger that appends to .vibe-flow/usage.log
  - src/telemetry/quotaTracker.ts: QuotaTracker class with configurable threshold (default: 50k tokens, 80%)
  - Monitors CLI usage and alerts when exceeding safety threshold
  - Persists state to .vibe-flow/quota-state.json
  - Build verified successfully

## Session Notes (2026-02-27)
- Created context window evaluation tests:
  - tests/fixtures/env_states.json: Mock data with 4 scenarios (8k/128k tokens)
  - tests/e2e/eval.ts: Standalone test runner script
  - tests/e2e/eval.test.ts: Jest test suite (7 tests, all passing)
- Tests verify agent behavior for small (8k) and massive (128k) context windows

## Session Notes (2026-02-26)
- Wrap-up session executed

## Session Notes (2026-02-26)
- Wrap-up session executed

## Session Notes (2026-02-26)
- Wrap-up session executed

## Session Notes (2026-02-26)
- Wrap-up session executed
## Session Notes (2026-02-27)
- Configured MCP (Model Context Protocol) for vibe-flow:
  - Installed @modelcontextprotocol/sdk@1.27.1
  - Created src/mcp/official-server.ts - Official MCP server using SDK
  - Created src/mcp/client.ts - MCP client for external servers
  - Added .claude/mcp.json - Claude Code MCP configuration
  - Added npm script "mcp" to run MCP server
  - Exposed tools: start_project, advance_step, get_status, analyze_project, wrap_up_session, get_guidance
  - Build successful - all TypeScript compiles correctly
  - Fixed multiple TypeScript build errors in src/quality/, src/security/, src/context/


## Session Notes (2026-02-26)
- Wrap-up session executed

## Session Notes (2026-02-26)
- Wrap-up session executed

## Session Notes (2026-02-27)
- Implemented hierarchical DAG summary system for context management:
  - Created src/context/summary-types.ts: LeafSummary, CondensedSummary, MessagePointer, SummaryPointer, DAGState types
  - Created src/context/dag-summary.ts: DAG management with provenance tracking
  - buildActiveContext() combines recent messages with DAG summaries
  - getProvenance() tracks all original message IDs through the DAG hierarchy
  - validateDAG() ensures DAG consistency
  - Build successful - tests pass with active context combining summaries + recent messages


## Session Notes (2026-02-26)
- Wrap-up session executed

## Session Notes (2026-02-27)
- Created src/decision/state-detector.ts with ProjectState enum (NEW, IN_PROGRESS, REVERSE_ENGINEERING)
- Implemented analyzeProjectMaturity(directoryPath) with heuristic weights:
  - package.json: +10, _bmad: +25, .ralph: +30, .git: +5
- Detection logic: .ralph → IN_PROGRESS, legacy code without BMAD → REVERSE_ENGINEERING, score ≤15 → NEW

## Session Notes (2026-02-26)
- Created WAL recovery module in src/error-handler/wal-recovery.ts
  - WALManager class with appendLog(state) and recoverLastValidState()
  - Uses fs/promises for async file I/O in .vibe-flow/wal/ directory
  - Handles JSON corruption by skipping invalid logs
  - Includes checksum validation for state integrity
  - Added 11 unit tests in tests/unit/wal-recovery.test.ts

## Session Notes (2026-02-26)
- Wrap-up session executed

## Session Notes (2026-02-26)
- Wrap-up session executed

## Session Notes (2026-02-26)
- Wrap-up session executed

## Session Notes (2026-02-26)
- Wrap-up session executed

## Session Notes (2026-02-26)
- Wrap-up session executed

## Session Notes (2026-02-26)
- Wrap-up session executed